===RUN THE FOLLOWING IN BASH===

###Issuer public key extraction
>openssl x509 -in momo-ca.1.crt.PEM -noout -text
Certificate:
Data:
Version: 1 (0x0)
Serial Number:
f7:fd:9f:18:11:52:17:bf
Signature Algorithm: sha256WithRSAEncryption
Issuer: C=UK, ST=Money Monsters, L=Hastings, O=Interface Devices Ltd., OU=Money Monsters, CN=moneymonster.*
Validity
Not Before: Sep 19 11:28:06 2018 GMT
Not After : Sep 16 11:28:06 2028 GMT
Subject: C=UK, ST=Money Monsters, L=Hastings, O=Interface Devices Ltd., OU=Money Monsters, CN=moneymonster.*
Subject Public Key Info:
Public Key Algorithm: rsaEncryption
RSA Public Key: (1024 bit)
Modulus (1024 bit):
00:b3:be:d0:2e:77:d5:2d:04:44:d8:47:02:bb:21:
48:c8:76:4e:f2:34:69:84:9c:eb:7a:53:be:2c:b8:
a2:db:cd:4b:5d:76:51:f0:71:5c:a9:32:4f:42:80:
7b:86:6d:29:e3:be:6b:98:52:88:96:46:fe:e3:d7:
68:fb:66:af:0e:cc:1e:e1:50:d9:fe:5f:4e:aa:7c:
16:8e:33:31:73:c7:52:e1:a4:ac:ef:f8:37:e3:45:
ff:ce:de:ea:25:22:1c:62:06:a2:75:08:af:bc:db:
80:82:e3:97:bb:e3:91:c6:3f:42:30:45:76:84:8f:
0a:27:e8:55:a7:a4:bf:bb:e3
Exponent: 65537 (0x10001)

##We want the public key modulus, we can also extract it other ways, but as this is going to be fixed we can just generate the modulus for all the 5 certificates:
#momo-ca.1: 00b3bed02e77d52d0444d84702bb2148c8764ef23469849ceb7a53be2cb8a2dbcd4b5d7651f0715ca9324f42807b866d29e3be6b9852889646fee3d768fb66af0ecc1ee150d9fe5f4eaa7c168e333173c752e1a4aceff837e345ffcedeea25221c6206a27508afbcdb8082e397bbe391c63f42304576848f0a27e855a7a4bfbbe3
#momo-ca.2: 00b8c514a10ddf78cb7b4edba34e75e873099c52d01e73d35396f00c337cc7b395517f6072502437589b9696959b8eec9a02aad9a0ad2dd8d441684d85a0e7f29375119a95a01abba54852308ada1c3aee980cae61c291c9e918b9f9bc87fddc0e5ee71448adcee1fa5f27f176d78bc321d03270a9494ed355e08d00334f0bbca7
#momo-ca.3: 00b5665f74f6e781127515ae65e53458daf438adf297ee65475f43aede2a847be050d7afb86b37fb3bac3b2e2bbd542db8cb20c7a26c94da01fa86b60dcf7466b0edd2b639f3f109211f0981584ca1bebae2ce78d2c852716ad1c347d81dfe0e9a2b0796e75227bdf9caee2b2ccbbf3fdb4d1275be31fa574867672ad62c71954f
#momo-ca.4: 00d2cc3e155431f4d114b6f12833077de775b5bc2a1da6722413b12cb8c00e249ddf71b87f784f8a08c473046547232d0ce589be5e29dd6a81922d2a115580af84211a11637ed0ec344570742bb7756089ee7ee2cf17939758ba2899fff3c32e443b97d2ec7c44f1da3b8db1a60173af9d7b1a4c89dd398975326d6d5ee6b83ee1
#momo-ca.5: 00ad2c12e2288fa9cfdea723128b1262a9262b4944169886b37d377d49b56252718635ba2f2ea4d6fc3d87c459058a145ae831ddef4f35668d263a5192ecf9e1bd36aa67de7dc6f19515579c7d8551f193b832f8de9b8368c2092900c9fb7d309a701ced53383e4dbf88bc19dd81282698f66faadd01a6349526b28041eb512cdf



####MONSTER DATA EXTRACTION (To be done in Swift)
openssl asn1parse -inform der -in moneymonster.local.DER
0:d=0  hl=4 l= 592 cons: SEQUENCE
4:d=1  hl=4 l= 441 cons: SEQUENCE
...
447:d=3  hl=2 l=   0 cons: SEQUENCE
449:d=1  hl=2 l=  13 cons: SEQUENCE
451:d=2  hl=2 l=   9 prim: OBJECT            :sha256WithRSAEncryption
462:d=2  hl=2 l=   0 prim: NULL
464:d=1  hl=3 l= 129 prim: BIT STRING

#TO BE SIGNED extraction from monster certificate
#4:d=1  hl=4 l= 441 cons: SEQUENCE --> How can we find the beginning and end? Swift Ans1 parser class?
>cat moneymonster.local.DER|xxd -p| tr -d '\n' | cut -c 9-898
308201b9a003020102020101300d06092a864886f70d01010b050030818c310b300906035504061302554b311730150603550408130e4d6f6e6579204d6f6e73746572733111300f0603550407130848617374696e6773311f301d060355040a1316496e746572666163652044657669636573204c74642e31173015060355040b130e4d6f6e6579204d6f6e7374657273311730150603550403130e6d6f6e65796d6f6e737465722e2a301e170d3138303931393131323830365a170d3238303931363131323830365a304b310b300906035504061302554b311f301d060355040a1316496e746572666163652044657669636573204c74642e311b3019060355040313126d6f6e65796d6f6e737465722e6c6f63616c30819f300d06092a864886f70d010101050003818d00308189028181008a2c8628e8f2be8123ef88e1fca4d67d97988c6b2aa10dba6bb34b49dfd1515677aa9971e78b053fd9e61c27d8df0f4a957ff2a79ed6a2d03b83c12abb76a44dbdbb92513cc7a47ba79f4b14a3d0a98be01b16ffb832b1da3506420711ffe8958fb94f39e1a96b8aa378834d2a4a0e25f9020d6a296005ef4d38a4efd20b045f0203010001a3023000

#Signature extraction from monster certificate
#464:d=1  hl=3 l= 129 prim: BIT STRING
#Beginning: 464*2+9, End: Beginning+256-1 --> How can we find the beginning and end? Swift Ans1 parser class?
>cat moneymonster.local.DER |xxd -p | tr -d '\n' | cut -c 937-1192
73f2d765df8a4815b5533c0453ea2c3ef837f20402a28dfb639b46ffba8cb6f63f1c9c7fdbd6f85fa0faf4c2642bfbb429a7b1da08b9f1d92a0fc7d8b5619c8f0b3892b84da89feb344e24a29c947d399c9001e0ec997383aaed225c7b57115f376f3f4d757d412c395ace922f0230d892adda7ac60aeccdef02bf542acd4ce9




===RUN THE FOLLOWING IN PYTHON===
>python
import hashlib

tbs="308201b9a003020102020101300d06092a864886f70d01010b050030818c310b300906035504061302554b311730150603550408130e4d6f6e6579204d6f6e73746572733111300f0603550407130848617374696e6773311f301d060355040a1316496e746572666163652044657669636573204c74642e31173015060355040b130e4d6f6e6579204d6f6e7374657273311730150603550403130e6d6f6e65796d6f6e737465722e2a301e170d3138303931393131323830365a170d3238303931363131323830365a304b310b300906035504061302554b311f301d060355040a1316496e746572666163652044657669636573204c74642e311b3019060355040313126d6f6e65796d6f6e737465722e6c6f63616c30819f300d06092a864886f70d010101050003818d00308189028181008a2c8628e8f2be8123ef88e1fca4d67d97988c6b2aa10dba6bb34b49dfd1515677aa9971e78b053fd9e61c27d8df0f4a957ff2a79ed6a2d03b83c12abb76a44dbdbb92513cc7a47ba79f4b14a3d0a98be01b16ffb832b1da3506420711ffe8958fb94f39e1a96b8aa378834d2a4a0e25f9020d6a296005ef4d38a4efd20b045f0203010001a3023000".decode("hex")

hashed_tbs=hashlib.sha256(tbs).hexdigest()

signature = 0x73f2d765df8a4815b5533c0453ea2c3ef837f20402a28dfb639b46ffba8cb6f63f1c9c7fdbd6f85fa0faf4c2642bfbb429a7b1da08b9f1d92a0fc7d8b5619c8f0b3892b84da89feb344e24a29c947d399c9001e0ec997383aaed225c7b57115f376f3f4d757d412c395ace922f0230d892adda7ac60aeccdef02bf542acd4ce9
modulus = 0x00b3bed02e77d52d0444d84702bb2148c8764ef23469849ceb7a53be2cb8a2dbcd4b5d7651f0715ca9324f42807b866d29e3be6b9852889646fee3d768fb66af0ecc1ee150d9fe5f4eaa7c168e333173c752e1a4aceff837e345ffcedeea25221c6206a27508afbcdb8082e397bbe391c63f42304576848f0a27e855a7a4bfbbe3


decryptedSignature=pow( signature, 65537, modulus )


print "The last 256 bytes from the decrypted signature should be the same as the hashed TBS"
print "%x" % decryptedSignature
print hashed_tbs

